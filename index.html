<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Tienda Online · Maquetación</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Estilos propios -->
  <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>
  <!-- NAV / HEADER -->
  <nav class="navbar navbar-expand-lg bg-white border-bottom sticky-top">
    <div class="container">
      <a class="navbar-brand" href="#">DeTodo</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMain" aria-controls="navMain" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navMain">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link active" aria-current="page" href="#">Inicio</a></li>
          <li class="nav-item"><a class="nav-link" href="#categorias">Categorías</a></li>
          <li class="nav-item"><a class="nav-link" href="#productos">Productos</a></li>
        </ul>
        <!-- Carrito esquina superior derecha -->
        <div class="d-flex align-items-center">
          <a href="#" class="position-relative text-decoration-none" aria-label="Carrito">
            <i class="bi bi-cart3 fs-4"></i>
            <span id="contadorCarrito" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger badge-cart">0</span>
          </a>
        </div>
      </div>
    </div>
  </nav>

  <!-- CAROUSEL SUPERIOR -->
  <div id="heroCarousel" class="carousel slide" data-bs-ride="carousel">
    <div class="carousel-indicators">
      <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
      <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="1" aria-label="Slide 2"></button>
      <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="2" aria-label="Slide 3"></button>
    </div>
    <div class="carousel-inner">
      <div class="carousel-item active">
        <!-- Imagen local movida a assets/img/ -->
        <img src="assets/img/banner2.png" class="d-block w-100 carousel-img" alt="Banner 1 (local)">
        <div class="carousel-caption d-none d-md-block">
          <h5>Novedades de temporada</h5>
          <p>Descubre lo último en nuestra colección.</p>
        </div>
      </div>
      <div class="carousel-item">
        <img src="https://picsum.photos/1200/340?random=12" class="d-block w-100 carousel-img" alt="Banner 2">
        <div class="carousel-caption d-none d-md-block">
          <h5>Envíos a todo el país</h5>
          <p>Rápido, seguro y con seguimiento.</p>
        </div>
      </div>
      <div class="carousel-item">
        <img src="https://picsum.photos/1200/340?random=13" class="d-block w-100 carousel-img" alt="Banner 3">
        <div class="carousel-caption d-none d-md-block">
          <h5>Ofertas relámpago</h5>
          <p>Aprovecha descuentos por tiempo limitado.</p>
        </div>
      </div>
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Anterior</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Siguiente</span>
    </button>
  </div>

  <!-- CUERPO PRINCIPAL -->
  <main class="container my-4">
    <div class="row g-4">
      <!-- Columna izquierda (categorías) -->
      <aside id="categorias" class="col-sm-12 col-md-3">
        <div class="p-3 bg-white rounded-3 shadow-sm">
          <div class="category-title mb-2">Categorías</div>
          <div class="list-group list-group-flush category-menu">
            <a href="#" class="list-group-item list-group-item-action">Categoría 1</a>
            <a href="#" class="list-group-item list-group-item-action">Categoría 2</a>
            <a href="#" class="list-group-item list-group-item-action">Categoría 3</a>
            <a href="#" class="list-group-item list-group-item-action">Categoría 4</a>
            <a href="#" class="list-group-item list-group-item-action">Categoría 5</a>
          </div>
        </div>
      </aside>

      <!-- Columna derecha (productos) -->
      <section id="productos" class="col-sm-12 col-md-9">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <h2 class="h5 m-0">Productos</h2>
          <div class="text-muted small">Cargados dinámicamente desde API</div>
        </div>

        <!-- Contenedor grid de productos -->
        <div id="contenedorProductos" class="row">
          <!-- Placeholder inicial / estado de carga -->
          <div class="col-12">
            <div class="alert alert-light border d-flex align-items-center" role="alert">
              <div class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></div>
              Cargando productos...
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- FOOTER -->
  <footer class="py-4">
    <div class="container text-center">
      <small class="text-muted">Diseñado por: Carlos Eduardo Hernández Lecointe – 1890-18-17646</small>
    </div>
  </footer>

  <!-- Bootstrap Bundle JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Script para renderizar productos (Fetch API + Bootstrap Cards) -->
  <script>
    (function(){
      const url = "https://backcvbgtmdesa.azurewebsites.net/api/productos";
      const contenedor = document.getElementById("contenedorProductos");
      const contadorCarrito = document.getElementById("contadorCarrito");
      let carrito = 0;

      async function cargarProductos(){
        try {
          const resp = await fetch(url);
          if (!resp.ok) throw new Error("HTTP " + resp.status);
          const productos = await resp.json();

          contenedor.innerHTML = ""; // limpiar placeholder

          if (!Array.isArray(productos) || productos.length === 0) {
            contenedor.innerHTML = '<div class="col-12"><div class="alert alert-warning">No hay productos para mostrar.</div></div>';
            return;
          }

          productos.forEach((producto) => {
            const col = document.createElement("div");
            // Requisitos de responsividad: 1 por fila en sm, 3 por fila en md+
            col.className = "col-sm-12 col-md-4 mb-4";

            let precioHTML = "";
            const precio = parseFloat(producto.Precio);
            const precioOferta = producto.PrecioOferta != null ? parseFloat(producto.PrecioOferta) : null;

            if (producto.EnOferta && precioOferta != null && !Number.isNaN(precioOferta)) {
              precioHTML = `
                <span class="text-danger fw-bold">Q${precioOferta.toFixed(2)}</span>
                <small class="text-muted text-decoration-line-through ms-2">Q${!Number.isNaN(precio) ? precio.toFixed(2) : ""}</small>
              `;
            } else {
              precioHTML = `<span class="fw-semibold">Q${!Number.isNaN(precio) ? precio.toFixed(2) : ""}</span>`;
            }

            // Imagen de respaldo si falla la URL
            const imgSrc = producto.Imagen || "https://placehold.co/600x400?text=Producto";

            col.innerHTML = `
              <div class="card h-100 shadow-sm">
                <img src="${imgSrc}" class="card-img-top" alt="${producto.Nombre || 'Producto'}" onerror="this.onerror=null;this.src='https://placehold.co/600x400?text=Sin+imagen';">
                <div class="card-body d-flex flex-column">
                  <h5 class="card-title">${producto.Nombre || 'Producto sin nombre'}</h5>
                  <p class="card-text small text-muted">${producto.Descripcion || ''}</p>
                  <p class="mb-3">${precioHTML}</p>
                  <button class="btn btn-primary mt-auto agregarCarrito" type="button">
                    <i class="bi bi-bag-plus me-1"></i> Agregar al carrito
                  </button>
                </div>
              </div>
            `;

            col.querySelector(".agregarCarrito").addEventListener("click", () => {
              carrito++;
              contadorCarrito.textContent = carrito;
              // feedback visual breve
              contadorCarrito.classList.add('bg-success');
              setTimeout(()=>contadorCarrito.classList.remove('bg-success'), 350);
            });

            contenedor.appendChild(col);
          });

          // Garantizar mínimo 6 cards visuales para el enunciado
          const cardsActuales = contenedor.querySelectorAll('.card').length;
          if (cardsActuales < 6 && cardsActuales > 0) {
            const faltan = 6 - cardsActuales;
            for (let i = 0; i < faltan; i++) {
              contenedor.appendChild(contenedor.children[i % cardsActuales].cloneNode(true));
            }
          }
        } catch (error) {
          console.error("Error al cargar productos:", error);
          contenedor.innerHTML = '<div class="col-12"><div class="alert alert-danger">No se pudieron cargar los productos. Intenta nuevamente más tarde.</div></div>';
        }
      }

      cargarProductos();
    })();
  </script>
</body>
</html>
